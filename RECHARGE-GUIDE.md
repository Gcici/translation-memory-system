# 💳 二维码充值系统使用指南

## 📋 功能概述

完整的二维码充值系统,支持:
- 用户扫码充值
- 上传支付凭证
- 管理员审核
- 自动到账
- 配额管理

---

## 🎯 用户使用流程

### 步骤1: 查看账户信息

1. 登录系统
2. 点击顶部导航 "💳 账户充值"
3. 查看当前:
   - 套餐类型
   - AI翻译剩余次数
   - 人工翻译剩余次数
   - 到期时间

### 步骤2: 选择充值套餐

**默认套餐:**
- **基础版** (¥19/月)
  - 100次 AI翻译
  - 20次 人工翻译
  - 30天有效期

- **标准版** (¥49/月)
  - 500次 AI翻译
  - 100次 人工翻译
  - 30天有效期

- **专业版** (¥99/月)
  - 2000次 AI翻译
  - 500次 人工翻译
  - 30天有效期

- **年费会员** (¥499/年)
  - 10000次 AI翻译
  - 5000次 人工翻译
  - 365天有效期

### 步骤3: 扫码支付

1. 选择套餐后,系统显示支付二维码
2. 使用微信/支付宝扫码
3. 完成支付

### 步骤4: 上传支付凭证

1. 截图支付成功页面
2. 点击"上传支付截图"
3. 选择截图文件
4. 预览确认

### 步骤5: 提交申请

1. 确认信息无误
2. 点击"提交充值申请"
3. 等待管理员审核(通常1-2小时)

### 步骤6: 查看结果

- 审核通过: 配额自动到账
- 审核拒绝: 查看拒绝原因
- 可在充值记录中查看所有历史

---

## 🔑 管理员操作指南

### 一、设置支付二维码(首次配置)

1. 登录管理员账号
2. 点击 "📱 二维码设置"
3. 准备收款二维码:
   - 微信: 微信 → 收付款 → 二维码收款
   - 支付宝: 支付宝 → 收钱 → 保存收钱码
4. 上传二维码图片
5. 点击"💾 保存二维码"

**建议:**
- 使用固定收款码(不会过期)
- 图片清晰,建议500x500px
- 定期检查收款账户

### 二、审核充值申请

1. 点击 "💰 充值审核"
2. 查看待审核列表
3. 点击查看支付凭证(可放大)
4. 核对:
   - 金额是否正确
   - 时间是否匹配
   - 凭证是否真实

**通过审核:**
1. 点击 "✅ 通过"
2. 可选填写备注
3. 用户配额自动到账

**拒绝审核:**
1. 点击 "❌ 拒绝"
2. 必须填写拒绝原因
3. 用户可查看原因

### 三、日常管理

**查看统计:**
- 待审核数量
- 已通过数量
- 已拒绝数量

**筛选查看:**
- ⏳ 待审核
- ✅ 已通过
- ❌ 已拒绝
- 📋 全部

---

## ⚙️ 数据库部署

### 部署SQL脚本

1. 登录Supabase控制台
2. 进入 SQL Editor
3. 打开 `recharge-system-setup.sql`
4. 复制全部内容
5. 粘贴并执行
6. 看到成功提示

### 验证部署

检查以下表是否创建成功:
- `recharge_records` - 充值记录
- `recharge_plans` - 充值套餐
- `system_config` - 系统配置

检查字段是否添加:
- `user_profiles` 表新增:
  - `balance` - 账户余额
  - `ai_quota` - AI翻译配额
  - `human_quota` - 人工翻译配额
  - `plan_type` - 套餐类型
  - `plan_expires_at` - 到期时间

---

## 📊 数据库结构

### recharge_records (充值记录表)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGSERIAL | 记录ID |
| user_id | UUID | 用户ID |
| amount | DECIMAL | 充值金额 |
| plan_type | VARCHAR | 套餐名称 |
| payment_proof | TEXT | 支付凭证(base64) |
| status | VARCHAR | 状态(pending/approved/rejected) |
| admin_note | TEXT | 管理员备注 |
| approved_by | UUID | 审核人ID |
| created_at | TIMESTAMP | 创建时间 |
| approved_at | TIMESTAMP | 审核时间 |

### recharge_plans (充值套餐表)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | SERIAL | 套餐ID |
| name | VARCHAR | 套餐名称 |
| price | DECIMAL | 价格 |
| ai_quota | INTEGER | AI翻译次数 |
| human_quota | INTEGER | 人工翻译次数 |
| duration_days | INTEGER | 有效期(天) |
| description | TEXT | 套餐描述 |
| is_active | BOOLEAN | 是否启用 |

### system_config (系统配置表)

| 字段 | 类型 | 说明 |
|------|------|------|
| key | VARCHAR | 配置键 |
| value | TEXT | 配置值 |
| description | TEXT | 说明 |
| updated_at | TIMESTAMP | 更新时间 |
| updated_by | UUID | 更新人 |

---

## 💰 定价策略建议

### 基础定价

**免费版:**
- AI翻译: 0次/月
- 人工翻译: 5次/月
- 适合: 尝鲜用户

**基础版(¥19/月):**
- AI翻译: 100次/月
- 人工翻译: 20次/月
- 适合: 个人用户

**标准版(¥49/月):**
- AI翻译: 500次/月
- 人工翻译: 100次/月
- 适合: 小团队

**专业版(¥99/月):**
- AI翻译: 2000次/月
- 人工翻译: 500次/月
- 适合: 企业用户

### 定价技巧

1. **阶梯定价** - 价格越高,性价比越好
2. **年付优惠** - 年付可以打8折
3. **首月优惠** - 首次购买9折
4. **推荐奖励** - 推荐新用户送次数

### 自定义套餐

在Supabase中修改 `recharge_plans` 表:

```sql
-- 添加新套餐
INSERT INTO recharge_plans 
(name, price, ai_quota, human_quota, duration_days, description)
VALUES 
('企业定制版', 299.00, 10000, 2000, 30, '适合大型企业');

-- 修改套餐
UPDATE recharge_plans 
SET price = 39.00, ai_quota = 200 
WHERE name = '基础版';

-- 停用套餐
UPDATE recharge_plans 
SET is_active = FALSE 
WHERE name = '基础版';
```

---

## 🔒 安全建议

### 防止欺诈

1. **仔细核对凭证**
   - 检查金额
   - 检查时间
   - 检查支付平台

2. **识别P图**
   - 注意字体
   - 注意排版
   - 可疑凭证拒绝

3. **设置限制**
   - 同一用户24小时内最多提交3次
   - 单笔充值上限
   - 异常行为标记

### 数据保护

- 支付凭证加密存储
- 定期备份充值记录
- 审核记录保留日志
- 财务数据单独备份

### 收款安全

- 使用企业收款账户
- 定期提现
- 避免余额过高
- 关注账户异常

---

## 📈 运营建议

### 审核时效

- 工作时间: 1小时内
- 非工作时间: 12小时内
- 特殊情况: 及时沟通

### 沟通话术

**审核通过:**
```
您好,您的充值已通过审核!
套餐: 标准版
金额: ¥49
配额已到账,祝使用愉快!
```

**审核拒绝:**
```
抱歉,您的充值申请未通过审核。
原因: 支付金额与套餐不符
建议: 请重新提交正确金额的凭证
如有疑问,请联系客服
```

### 用户教育

在充值页面添加说明:
- 如何正确截图
- 支付后多久审核
- 遇到问题怎么办
- 客服联系方式

---

## 🔧 高级功能

### 自动充值(需开发)

对接支付平台API:
- 微信支付
- 支付宝
- Stripe

优点:
- 无需人工审核
- 秒到账
- 降低工作量

缺点:
- 需要企业资质
- 支付手续费
- 开发成本高

### 充值优惠券

在数据库添加优惠券表:

```sql
CREATE TABLE coupons (
  code VARCHAR(50) PRIMARY KEY,
  discount_percent INTEGER,
  discount_amount DECIMAL(10,2),
  valid_until DATE,
  max_use INTEGER,
  used_count INTEGER DEFAULT 0
);
```

### 充值返利

设置推荐奖励:
- 邀请人: 获得10%返现
- 被邀请人: 首次充值9折

---

## 📊 数据分析

### 关键指标

**充值转化率:**
```
转化率 = 充值用户数 / 注册用户数
```

**人均充值:**
```
ARPU = 总充值金额 / 充值用户数
```

**复购率:**
```
复购率 = 二次充值用户数 / 首次充值用户数
```

### SQL查询示例

**查看充值统计:**
```sql
SELECT 
  COUNT(*) as total_recharges,
  SUM(amount) as total_amount,
  AVG(amount) as avg_amount,
  COUNT(DISTINCT user_id) as unique_users
FROM recharge_records
WHERE status = 'approved'
AND created_at > NOW() - INTERVAL '30 days';
```

**查看套餐分布:**
```sql
SELECT 
  plan_type,
  COUNT(*) as count,
  SUM(amount) as revenue
FROM recharge_records
WHERE status = 'approved'
GROUP BY plan_type
ORDER BY revenue DESC;
```

---

## 🆘 常见问题

### Q1: 支付了但忘记截图怎么办?

**A:** 
- 微信: 我 → 支付 → 钱包 → 账单
- 支付宝: 我的 → 账单
- 重新截图提交即可

### Q2: 审核需要多久?

**A:** 
- 工作日: 1-2小时
- 节假日: 可能延迟
- 24小时内必须完成

### Q3: 审核被拒绝怎么办?

**A:** 
- 查看拒绝原因
- 重新上传正确凭证
- 联系客服说明情况

### Q4: 能否退款?

**A:** 
- 未使用配额: 可以退款
- 已使用配额: 按比例退
- 违规使用: 不退款

### Q5: 充值后多久到期?

**A:** 
- 从审核通过时开始计算
- 到期前7天会提醒
- 到期后配额清零

### Q6: 可以叠加购买吗?

**A:** 
- 可以!配额会累加
- 有效期以最后一次为准
- 建议到期前续费

---

## 🎯 最佳实践

### 用户端

1. **及时充值** - 避免配额用完
2. **保存凭证** - 截图保存好
3. **核对信息** - 提交前检查
4. **耐心等待** - 给审核时间

### 管理员端

1. **快速响应** - 及时审核
2. **仔细核对** - 避免错误
3. **礼貌沟通** - 态度友好
4. **记录详细** - 便于追溯

---

## 📞 技术支持

**部署问题:**
1. 检查SQL是否执行成功
2. 验证表和字段是否创建
3. 确认RLS策略已设置
4. 查看浏览器控制台错误

**功能问题:**
- 二维码显示不了: 检查图片格式和大小
- 提交失败: 检查网络和权限
- 审核不生效: 检查存储过程

---

**祝充值系统运营顺利!** 💰

这是一个完整的**企业级充值管理系统**!
